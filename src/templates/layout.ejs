<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Inline script to prevent flash of wrong theme -->
  <script>
    (function() {
      const savedTheme = localStorage.getItem('theme');
      const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = savedTheme || (systemDark ? 'dark' : 'light');
      document.documentElement.classList.add(theme);
    })();
  </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= typeof title !== 'undefined' ? title : 'Mega Memory' %></title>
  
  <!-- Tailwind CSS v4 CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/provider-icons.css">
  <link rel="stylesheet" href="/css/styles.css">
  
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            // IntelliJ-like colors for dark theme
            'jb-dark': {
              bg: '#2b2b2b',
              'bg-secondary': '#313335',
              'bg-tertiary': '#3c3f41',
              fg: '#bbbbbb',
              'fg-secondary': '#808080',
              accent: '#589df6',
              'accent-hover': '#4985d0',
              border: '#555555',
              selection: '#214283',
              comment: '#808080',
            },
            // Light theme
            'jb-light': {
              bg: '#ffffff',
              'bg-secondary': '#f7f7f7',
              'bg-tertiary': '#eeeeee',
              fg: '#000000',
              'fg-secondary': '#666666',
              accent: '#0066cc',
              'accent-hover': '#0052a3',
              border: '#cccccc',
              selection: '#d6ebff',
              comment: '#808080',
            },
            // Message colors for dark
            'msg-dark': {
              user: { bg: '#2d3b55', border: '#589df6' },
              assistant: { bg: '#2d4a3e', border: '#36a3d6' },
              thinking: { bg: '#3d3455', border: '#9876aa' },
              tool: { bg: '#4a3d2d', border: '#cc7832' },
              error: { bg: '#4a2d2d', border: '#ff6b6b' },
            },
            // Message colors for light
            'msg-light': {
              user: { bg: '#e8f0fe', border: '#0066cc' },
              assistant: { bg: '#e6f4ea', border: '#1e8e3e' },
              thinking: { bg: '#f3e8fd', border: '#9334e6' },
              tool: { bg: '#fef3e8', border: '#f9ab00' },
              error: { bg: '#fce8e8', border: '#d93025' },
            },
          }
        }
      }
    }
  </script>
</head>
<body class="min-h-screen bg-jb-light-bg dark:bg-jb-dark-bg text-jb-light-fg dark:text-jb-dark-fg">
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-jb-light-bg-secondary dark:bg-jb-dark-bg-secondary border-b border-jb-light-border dark:border-jb-dark-border">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-14">
        <div class="flex items-center gap-3">
          <a href="/" class="flex items-center gap-2 text-xl font-semibold hover:text-jb-light-accent dark:hover:text-jb-dark-accent transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
            </svg>
            Mega Memory
          </a>
        </div>
        
        <div class="flex items-center gap-4">
          <!-- Search -->
          <a href="/search" class="p-2 rounded-lg hover:bg-jb-light-bg-tertiary dark:hover:bg-jb-dark-bg-tertiary transition-colors" aria-label="Search">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </a>
          <!-- Theme Toggle -->
          <button id="theme-toggle" class="p-2 rounded-lg hover:bg-jb-light-bg-tertiary dark:hover:bg-jb-dark-bg-tertiary transition-colors" aria-label="Toggle theme">
            <!-- Sun icon for dark mode -->
            <svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
            <!-- Moon icon for light mode -->
            <svg class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Breadcrumbs -->
  <% if (typeof breadcrumbs !== 'undefined' && breadcrumbs.length > 0) { %>
  <nav class="bg-jb-light-bg-tertiary dark:bg-jb-dark-bg-tertiary border-b border-jb-light-border dark:border-jb-dark-border">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <ol class="flex items-center gap-2 py-3 text-sm">
        <% breadcrumbs.forEach((crumb, index) => { %>
          <% if (index > 0) { %>
            <li class="text-jb-light-comment dark:text-jb-dark-comment">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </li>
          <% } %>
          <li>
            <% if (crumb.active) { %>
              <span class="text-jb-light-accent dark:text-jb-dark-accent font-medium"><%= crumb.label %></span>
            <% } else { %>
              <a href="<%= crumb.url %>" class="text-jb-light-comment dark:text-jb-dark-comment hover:text-jb-light-accent dark:hover:text-jb-dark-accent transition-colors"><%= crumb.label %></a>
            <% } %>
          </li>
        <% }); %>
      </ol>
    </div>
  </nav>
  <% } %>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <%- body %>
  </main>

  <!-- Theme Toggle Script with Auto-Detection -->
  <script>
    const themeToggle = document.getElementById('theme-toggle');
    const html = document.documentElement;

    // Get saved theme, or check system preference
    const savedTheme = localStorage.getItem('theme');
    const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const currentTheme = savedTheme || (systemDark ? 'dark' : 'light');

    // Apply initial theme (avoid flash by setting before DOM ready)
    html.classList.remove('light', 'dark');
    html.classList.add(currentTheme);

    themeToggle.addEventListener('click', () => {
      const newTheme = html.classList.contains('dark') ? 'light' : 'dark';
      html.classList.remove('light', 'dark');
      html.classList.add(newTheme);
      localStorage.setItem('theme', newTheme);
    });

    // Optional: Listen for system theme changes when no manual preference is set
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      if (!localStorage.getItem('theme')) {
        const newTheme = e.matches ? 'dark' : 'light';
        html.classList.remove('light', 'dark');
        html.classList.add(newTheme);
      }
    });
  </script>
</body>
</html>